version: '3'
services:
  test:
    build: .
    volumes:
      - ./reports:/app/reports
      - ./src/fixtures:/app/src/fixtures
    environment:
      - CI=true
      - NODE_ENV=ci
      - PWDEBUG=0
      - RETRIES=2
    user: root
    
    # CRITICAL FIX: Ensures the workflow continues to reporting even if tests fail (exit code 1)
    command: sh -c "npm run test:all || true" 
    restart: "no"
